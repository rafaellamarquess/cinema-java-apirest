<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lista de Filmes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">Lista de Filmes</h1>

    <div class="text-end mb-3">
    <a th:href="@{/filmes/novo}" class="btn btn-success">Adicionar Filme</a>
    </div>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th scope="col">Título</th>
            <th scope="col">Gênero</th>
            <th scope="col">Sinopse</th>
            <th scope="col">Ano Lançamento</th>
            <th scope="col">Ações</th>
        </tr>
        </thead>

        <tbody id="filmes-tbody">
        <!-- filmes vão aqui -->
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        // Função para carregar filmes da API
        function carregarFilmes() {
            $.ajax({
                url: '/api/filmes',
                type: 'GET',
                dataType: 'json',
                success: function (filmes) {
                    const tbody = $('#filmes-tbody');
                    tbody.empty(); // Limpa o conteúdo anterior
                    filmes.forEach(function (filme) {
                        const row = `
                            <tr>
                                <td>${filme.titulo}</td>
                                <td>${filme.genero}</td>
                                <td>${filme.sinopse}</td>
                                <td>${filme.anoLancamento}</td>
                                <td>
                                    <a href="/filmes/${filme.id}/editar" class="btn btn-warning btn-editar">Editar</a>
                                    <button class="btn btn-danger btn-deletar" data-id="${filme.id}">Deletar</button>
                                </td>
                            </tr>
                        `;
                        tbody.append(row);
                    });
                },
                error: function () {
                    alert('Erro ao carregar filmes!');
                }
            });
        }
        carregarFilmes();

        // Função para excluir um filme
        $(document).on('click', '.btn-deletar', function () {
            const id = $(this).data('id');
            if (confirm('Tem certeza que deseja excluir este filme?')) {
                $.ajax({
                    url: `/api/filmes/${id}`,
                    type: 'DELETE',
                    success: function () {
                        alert('Filme excluído com sucesso!');
                        carregarFilmes();
                    },
                    error: function () {
                        alert('Erro ao excluir filme!');
                    }
                });
            }
        });
    });
</script>
</body>
</html>