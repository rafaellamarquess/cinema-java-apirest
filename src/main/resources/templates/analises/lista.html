<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lista de Análises</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">Análises Cadastradas</h1>

    <div class="text-end mb-3">
        <a th:href="@{/analises/nova}" class="btn btn-success">Adicionar Nova Análise</a>
    </div>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th scope="col">Filme</th>
            <th scope="col">Análise</th>
            <th scope="col">Nota</th>
            <th scope="col">Ações</th>
        </tr>
        </thead>

        <tbody id="analises-tbody">
        <!-- lista analise vai aqui -->
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        // Função para carregar análises da API
        function carregarAnalises() {
            $.ajax({
                url: '/api/analises',
                type: 'GET',
                dataType: 'json',
                success: function (analises) {
                    const tbody = $('#analises-tbody');
                    tbody.empty(); // Limpa o conteúdo anterior
                    analises.forEach(function (analise) {
                        const row = `
                            <tr>
                                <td>${analise.filme.titulo}</td> <!-- Acessa o título do filme relacionado à análise -->
                                <td>${analise.analise}</td> <!-- Exibe a análise -->
                                <td>${analise.nota}</td> <!-- Exibe a nota da análise -->
                                <td>
                                    <a href="/analises/editar/{id}" class="btn btn-warning btn-editar">Editar</a>
                                    <button class="btn btn-danger btn-deletar" data-id="${analise.id}">Deletar</button>
                                </td>
                            </tr>
                        `;
                        tbody.append(row);
                    });
                },
                error: function () {
                    alert('Erro ao carregar análises!');
                }
            });
        }
        carregarAnalises();

        // Função para excluir uma análise
        $(document).on('click', '.btn-deletar', function () {
            const id = $(this).data('id');
            if (confirm('Tem certeza que deseja excluir esta análise?')) {
                $.ajax({
                    url: `/api/analises/${id}`, // Endpoint para excluir a análise
                    type: 'DELETE',
                    success: function () {
                        alert('Análise excluída com sucesso!');
                        carregarAnalises();
                    },
                    error: function () {
                        alert('Erro ao excluir análise!');
                    }
                });
            }
        });
    });
</script>
</body>
</html>